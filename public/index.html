<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>chat-widget ‚Äì Instant Embed Chatbot</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 2rem;
      max-width: 720px;
      margin-inline: auto;
      background: #f8f8f8;
      color: #111;
    }

    h1 {
      font-size: 2rem;
    }

    code,
    pre {
      background: #eee;
      padding: 0.5rem;
      display: block;
      overflow-x: auto;
      border-radius: 4px;
      margin-top: 0.5rem;
      white-space: pre-wrap;
    }

    .demo {
      margin: 2rem 0;
      padding: 1rem;
      border: 1px dashed #ccc;
      background: #fff;
    }

    label {
      display: block;
      margin-top: 1rem;
      font-size: 0.9rem;
    }

    textarea,
    select,
    button {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.25rem;
      font-size: 0.9rem;
    }

    button {
      cursor: pointer;
    }

    .floating-note {
      font-size: 0.9rem;
      color: #666;
      margin-top: 0.5rem;
    }
  </style>
</head>

<body>

  <h1>üí¨ chat-widget</h1>
  <p>Instantly embed a chatbot on any website. Lightweight. Configurable. Powered by GPT.</p>

  <h2>üöÄ How to Use</h2>
  <p>Paste this into your HTML:</p>
  <pre><code>&lt;script type="application/json" id="chat-widget-config-001"&gt;
{
  "chatbot": {
    "instructions": "You're a helpful assistant for this site."
  }
}
&lt;/script&gt;
&lt;script src="https://chat-widget.uft1.com/embed.js"&gt;&lt;/script&gt;
</code></pre>
  <h2>üìò Config Options</h2>
  <ul>
    <li><strong>siteID</strong>: Optional site identifier</li>
    <li><strong>theme</strong>: "light" (default) or "dark"</li>
    <li><strong>position</strong>: "bottom-right" (default), "bottom-left", "top-right", "top-left"</li>
    <li><strong>instructions</strong>: Prompt for your chatbot's behavior</li>
  </ul>

  <p>üìÇ <a href="https://github.com/jovylle/chatbot-widget" target="_blank">View on GitHub</a></p>
  <h2>üß™ Live Demo</h2>
  <p>Use the form below to override instructions & position‚Äîno URL params will show, and the widget updates instantly.</p>
  <div id="demo-form" class="demo">
      <label for="demo-instructions">Instructions:</label>
      <textarea id="demo-instructions" rows="4">You are an AI assistant for Bella, the owner of Sunset Avenue Salon in Cebu City. You help clients with expert hair-care advice, share behind-the-scenes salon stories, and offer tips on managing hair in our humid climate‚Äîall with Bella‚Äôs friendly touch.</textarea>

      <label for="demo-position">Position:</label>
      <select id="demo-position">
        <option value="bottom-right">bottom-right</option>
        <option value="bottom-left">bottom-left</option>
        <option value="top-right">top-right</option>
        <option value="top-left">top-left</option>
      </select>

      <button type="submit" id="update-demo">Update Chatbot</button>

    <!-- fallback config JSON -->
    <script type="application/json" id="chat-widget-config-001">
    {
      "chatbot": {
        "siteID": "demo",
        "theme": "light",
        "position": "bottom-right",
        "instructions": "You are an AI assistant for Bella, the owner of Sunset Avenue Salon in Cebu City. You help clients with expert hair-care advice, share behind-the-scenes salon stories, and offer tips on managing hair in our humid climate‚Äîall with Bella‚Äôs friendly touch."
      }
    }
    </script>

    <div class="floating-note">üß† Edit the form above and hit ‚ÄúUpdate Chatbot‚Äù to see changes without reloading.</div>
  </div>

  <!-- This is where the widget will mount -->
  <script>
    // parse fragment into { key: value }
    function parseFragment () {
      const hash = location.hash.slice(1);
      return hash
        ? Object.fromEntries(hash.split('&').map(pair => {
          const [k, v] = pair.split('=');
          return [decodeURIComponent(k), decodeURIComponent(v)];
        }))
        : {};
    }

    // build & inject the snippet into the <pre><code> block
    function updateEmbedCode (instructions, position) {
        const escaped = instructions.replace(/"/g, '\\"');
      const snippet =
        `<script type="application/json" id="chat-widget-config-001">
{
  "chatbot": {
    "siteID": "demo",
    "theme": "light",
    "position": "${position}",
    "instructions": "${escaped}"
  }
}
  <\/script>
  <script src="/embed.js"><\/script>`;
      document.getElementById('embed-code').innerText = snippet;
    }

    const fallbackScript = document.getElementById('chat-widget-config-001');
    let liveEmbedScript;

    function getFallbackBotConfig () {
      const defaultConfig = { chatbot: {} };
      if (!fallbackScript) return defaultConfig.chatbot;
      try {
        const parsed = JSON.parse(fallbackScript.textContent || '');
        return (parsed && parsed.chatbot) || defaultConfig.chatbot;
      } catch (error) {
        console.warn('Invalid fallback config JSON.');
        return defaultConfig.chatbot;
      }
    }

    function updateFallbackConfig (instructions, position) {
      if (!fallbackScript) return;
      const payload = {
        chatbot: {
          siteID: 'demo',
          theme: 'light',
          position,
          instructions
        }
      };
      fallbackScript.textContent = JSON.stringify(payload, null, 2);
    }

    function loadLiveWidget () {
      liveEmbedScript?.remove();
      liveEmbedScript = document.createElement('script');
      liveEmbedScript.src = '/embed.js';
      liveEmbedScript.async = false;
      document.body.appendChild(liveEmbedScript);
    }

    function renderEmbedSnippet () {
      const bot = getFallbackBotConfig();
      const frag = parseFragment();
      const instructions = frag.instructions || bot.instructions || "You're a helpful assistant.";
      const position = frag.position || bot.position || 'bottom-right';
      updateEmbedCode(instructions, position);
      updateFallbackConfig(instructions, position);
      loadLiveWidget();
    }

    window.addEventListener('DOMContentLoaded', () => {
      renderEmbedSnippet();
      document.getElementById('update-demo').addEventListener('click', () => {
        const instr = encodeURIComponent(
          document.getElementById('demo-instructions').value
        );
        const pos = document.getElementById('demo-position').value;
        location.hash = `instructions=${instr}&position=${pos}`;
      });
    });

    window.addEventListener('hashchange', renderEmbedSnippet);
  </script>

  <h3>Your Embed Code</h3>
  <pre><code id="embed-code"></code></pre>


</body>

</html>